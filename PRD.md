# PRD: EC-MBR AI 기반 하수처리 무인 자동화 시스템

**담당 기업:** 신호테크놀로지
**문서 버전:** 2.0
**작성일:** 2025-12-01
**최종 수정:** TCN 아키텍처 적용, 문서 통합

---

## 1. 개요

### 1.1. 제품 비전

기존의 '사후 대응(Feedback)' 방식 하수처리 제어를 **'유입수 성상 예측 기반의 사전 대응(Feed-forward)'** 방식으로 혁신하는 AI 솔루션 개발. 유입 단계에서 수질, 유량 등을 선제적으로 감지하고, AI(TCN)가 미래 부하를 예측하여 송풍기 및 펌프를 최적 제어(PSO)함으로써 **완전 무인 자동운전**을 실현한다.

### 1.2. 연구 배경

- **현황**: 국내 하수처리장은 지자체 전력의 30~40%를 소비하며, 운영 인력 부족으로 무인화 수요가 급증
- **문제점**: 현재의 사후 제어 방식은 반응 속도가 느려 수질 기준 초과 위험이 있고, 과잉 포기(Over-aeration)로 인한 에너지 낭비가 심각

### 1.3. 목표 처리장

- **금강엔지니어링 EC-MBR 폐수처리시설**
- 처리 용량: 200~500 m³/일
- 기존 PLC: LS 또는 Mitsubishi
- 통신: Modbus TCP

### 1.4. 핵심 성과 지표 (KPI)

| 구분 | 성능지표 | 목표치 | 비고 |
|------|----------|--------|------|
| **수질 안정성** | 방류수 수질 기준 초과 | **0회/년** | 법적 기준 100% 준수 |
| **에너지 효율** | 전력 소비 절감률 | **15% 이상** | 기존 대비 |
| **예측 정확도** | 유입 부하 예측 MAPE | **10% 이하** | 6시간 선행 예측 |
| **자동화 수준** | 무인 운전 지속 시간 | **72시간 이상** | 운영자 개입 없음 |
| **경제성** | 투자 회수 기간 (ROI) | **45일 이내** | 엣지 기반 |

### 1.5. 개발 범위 (4-Layer)

| 레이어 | 주요 개발 내용 |
|--------|----------------|
| **Sensing Layer** | 센서 데이터 수집, 전처리, QA/QC 시스템 |
| **Analytics Layer** | TCN 예측 모델, PSO 최적화 엔진, 검증 체계 |
| **Control Layer** | Feed-forward 제어 로직, Safety Layer, PLC 연동 |
| **Edge Infrastructure** | 3-Tier 하이브리드 아키텍처, 데이터 압축/전송 |

---

## 2. 시스템 아키텍처

### 2.1. 4-Layer 전체 구조

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        EC-MBR AI 자동운전 플랫폼                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐  │
│  │   Sensing   │───▶│  Analytics  │───▶│   Control   │───▶│    Edge     │  │
│  │    Layer    │    │    Layer    │    │    Layer    │    │Infrastructure│  │
│  └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘  │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                    EC-MBR 특화 모듈 (차별화 핵심)                        │   │
│  │  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐            │   │
│  │  │ 전극 수명 예측   │  │ 동적막 형성      │  │ 전기응집-MBR    │            │   │
│  │  │   AI 모듈      │  │  최적화 모듈     │  │  통합 제어      │            │   │
│  │  └───────────────┘  └───────────────┘  └───────────────┘            │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.2. 실시간 운영 Flow

```
┌─────────────────────────────────────────────────────────────┐
│                   센서 데이터 수집 (1분 주기)                    │
│  (수위, pH, 유량, 온도, 탁도, DO, SS, EC 전압/전류 등)             │
└────────────────────┬────────────────────────────────────────┘
                 TCN ↓ (Temporal Convolutional Network, NPU 가속)
┌─────────────────────────────────────────────────────────────┐
│            TCN with Control Fusion (5분 주기)                 │
│  - 수질 예측 (COD, BOD, SS, T-N, T-P)                         │
│  - 전극 잔여수명, 막 오염 지수 예측                                │
│  ⚡ Hailo-8L NPU 가속 (0.8~1.2초 추론)                          │
└────────────────────┬────────────────────────────────────────┘
                 PSO ↓ (Particle Swarm Optimization, CPU 실행)
┌─────────────────────────────────────────────────────────────┐
│              PSO 최적 제어 파라미터 탐색 (30분 주기)               │
│  - 펌프 ON/OFF 타이밍, 약품 투입량, 에너지 최소화                    │
│  ⏱️ CPU 실행 (~45초)                                          │
└────────────────────┬────────────────────────────────────────┘
                     ↓
┌─────────────────────────────────────────────────────────────┐
│       Safety Layer (6층 검증) → PLC 제어 명령 실행               │
└─────────────────────────────────────────────────────────────┘
```

### 2.3. Feed-forward vs Feedback 비교

```
[기존 Feedback 제어 - 사후 처방]

유입수 ──▶ [폭기조 6~12h 체류] ──▶ 방류수 ──▶ 수질 측정
                                              │
                                              ▼
                                      "COD 높네? 송풍량 올려!"
                                              │
                                              ▼
                                      이미 늦음... (6시간 전 유입수는 이미 방류)


[Feed-forward 제어 - 사전 처방 ✨]

유입수 ──▶ AI 예측: "6시간 후 COD 높을 예정!"
    │              │
    │              ▼
    │      지금 바로 송풍량 증가
    │              │
    ▼              ▼
[폭기조] ──▶ [분리막조] ──▶ 방류수 ──▶ 수질 양호 ✅
(강화된 처리)
```

### 2.4. 연산 분배

| 모듈 | 실행 위치 | 추론 시간 |
|------|----------|----------|
| TCN 예측 | NPU (Hailo-8L) | 0.8~1.2초 |
| PSO 최적화 | CPU (ARM Cortex) | ~45초 |
| Safety Layer | CPU | < 100ms |
| PLC 통신 | CPU | < 10ms |

---

## 3. AI 모델: TCN (Temporal Convolutional Network)

### 3.1. 아키텍처 선정 근거

> ⚠️ **중요**: Hailo-8L NPU는 LSTM/GRU/RNN을 지원하지 않음.
> Conv1D 기반 TCN을 채택하여 NPU 가속 실현.

**TCN vs LSTM 비교:**

| 항목     | TCN (채택)      |  Bi-LSTM (미채택)  |
|----------|---------------|------------------|
| NPU 호환 | ✅ 완벽 지원     | ❌ 미지원 |
| 추론 시간 | 0.8~1.2초       | 8~12초 (CPU) |
| 병렬 처리 | ✅ 가능         | ❌ 순차 처리 |
| 모델 크기 | ~4.5MB (INT8)  | ~18MB (FP32) |
| 정확도 | MAPE < 10% | 기준 동일 |

### 3.2. TCN 모델 구조

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                 TCN (Temporal Convolutional Network)                        │
│                    with Control Variable Fusion                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   입력: [1, 4320, 25]  (72시간 × 60분 = 4320 timesteps, 25 features)           │
│          │                                                                  │
│          ▼                                                                  │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │              Dilated Causal Conv1D Block 1~7                        │   │
│   │                                                                     │   │
│   │   Dilation rates: 1, 2, 4, 8, 16, 32, 64                            │   │
│   │   각 Block: Conv1D(64, k=3) → BatchNorm → ReLU → Dropout(0.2)        │   │
│   │             → Conv1D(64) → BatchNorm → ReLU → Dropout(0.2)          │   │
│   │             → Residual Connection (+)                               │   │
│   │                                                                     │   │
│   │   Receptive Field: 509 timesteps (~8.5시간)                          │   │
│   └───────────────────────────────┬─────────────────────────────────────┘   │
│                                   │                                         │
│                                   ▼                                         │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                   Global Average Pooling 1D                         │   │
│   │                   [1, 4320, 64] → [1, 64]                           │   │
│   └───────────────────────────────┬─────────────────────────────────────┘   │
│                                   │                                         │
│                                   ▼                                         │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                     Control Variable 융합                            │   │
│   │                                                                     │   │
│   │   시계열 특징 [64] ──┬──▶ [Concatenate] ──▶ [68]                     │   │
│   │                   │                                               │   │
│   │   제어 변수 [4] ─────┘   (송풍량, PAC, Polymer, 전류밀도)              │   │
│   │                                                                     │   │
│   │   → Dense(64, ReLU) → Dropout(0.3) → Dense(15)                     │   │
│   └───────────────────────────────┬─────────────────────────────────────┘   │
│                                   │                                         │
│                                   ▼                                         │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                        Output (15개)                                │   │
│   │                                                                     │   │
│   │   ┌─────────────────────────────────────────────────────┐           │   │
│   │   │         │ 1시간 후  │ 3시간 후 │ 6시간 후  │           │           │   │
│   │   │─────────┼─────────┼─────────┼─────────┤           │           │   │
│   │   │ COD     │    -    │    -    │    -    │ mg/L      │           │   │
│   │   │ BOD     │    -    │    -    │    -    │ mg/L      │           │   │
│   │   │ SS      │    -    │    -    │    -    │ mg/L      │           │   │
│   │   │ T-N     │    -    │    -    │    -    │ mg/L      │           │   │
│   │   │ T-P     │    -    │    -    │    -    │ mg/L      │           │   │
│   │   └─────────────────────────────────────────────────────┘           │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│   ✅ NPU 호환: Conv1D, BatchNorm, ReLU, Pooling, Dense 모두 Hailo 지원     │
│   ⚡ 추론 시간: 0.8~1.2초 (NPU 가속)                                        │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.3. 입력 데이터 구조

**그룹 A: 시계열 데이터 (72시간 × 25개 features)**

| 분류 | 변수 | 개수 |
|------|------|------|
| 센서 직접값 | pH, DO, ORP, 탁도, 수온, 유입 COD/BOD/SS/TN/TP, MLSS, 유량, TMP, EC 전압/전류 | 15개 |
| 파생 변수 | F/M비, HRT, SRT, 유기물 부하율, 송풍기 가동률, 반송슬러지 비율, EC 전력량 | 7개 |
| 시간 변수 | 시간대(0~23), 요일(0~6), 계절(1~4) | 3개 |

**그룹 B: 제어 변수 (4개)**

| 변수 | 범위 |
|------|------|
| 송풍량 설정값 | 0~50 m³/min |
| PAC 투입량 | 0~200 mg/L |
| Polymer 투입량 | 0~10 mg/L |
| 전기응집 전류밀도 | 0~15 A/m² |

### 3.4. 모델 변환 파이프라인

```
┌─────────────────────────────────────────────────────────────────┐
│                    모델 변환 파이프라인                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   [학습 서버]                                                     │
│        │                                                        │
│        ▼                                                        │
│   ┌─────────────┐                                               │
│   │ TensorFlow  │  ← TCN 원본 모델 (FP32, ~18MB)                  │
│   │   (.h5)     │                                               │
│   └──────┬──────┘                                               │
│          │ tf2onnx                                              │
│          ▼                                                      │
│   ┌─────────────┐                                               │
│   │    ONNX     │  ← 중간 포맷 (~18MB)                            │
│   │  (.onnx)    │                                               │
│   └──────┬──────┘                                               │
│          │ Hailo Dataflow Compiler                              │
│          ▼                                                      │
│   ┌─────────────┐                                               │
│   │  Hailo HEF  │  ← INT8 양자화 (~4.5MB, 75% 경량화)              │
│   │   (.hef)    │    NPU 가속 ✓                                  │
│   └─────────────┘    추론 시간: 0.8~1.2초 ⚡                        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 3.5. 학습 전략

| 항목 | 설정값 |
|------|--------|
| 데이터 분할 | Train 70% / Validation 15% / Test 15% |
| Optimizer | Adam (lr=0.001) |
| Loss | Huber Loss |
| Batch Size | 128 |
| Epochs | 200 (Early Stopping patience=20) |
| Regularization | L2 (λ=0.001) + Dropout 0.2/0.3 |

### 3.6. 성능 목표

| 지표 | 목표치 | 비고 |
|------|--------|------|
| MAPE | < 10% | LSTM 동등 수준 |
| R² Score | > 0.85 | |
| 방향 정확도 | > 90% | |
| 추론 시간 | < 1.5초 (엣지) | TCN + NPU 가속 |
| 모델 크기 | < 5MB | INT8 양자화 |

### 3.7. EC-MBR 특화 예측 모델

| 모델 | 목적 | 입력 | 출력 | 독창성 |
|------|------|------|------|--------|
| 전극 수명 예측 | 전극 교체 시기 최적화 | 전압변동, 전류밀도, 운전시간 | 잔여수명(hr) | 정역 극전환 주기 자동 최적화 |
| 동적막 형성 예측 | Al(OH)₃ 동적막 두께 제어 | 전기응집 조건, TMP | 최적 동적막 상태 | EC-MBR 시너지 극대화 |
| 통합 오염 예측 | 전극+막 동시 관리 | 복합 센서 데이터 | 세정 스케줄 | 이원화 관리 → 통합 관리 |

---

## 4. PSO 최적화 엔진

### 4.1. 최적화 대상

- 약품 투입량 (PAC, Polymer, NaOH)
- 펌프 운전 스케줄 (24시간)
- 터보 브로워 속도 (0~100%)
- 분리막 운전 사이클 (흡입/휴지 시간)
- 전기응집 전류밀도, 극전환 주기 ★

### 4.2. 목적함수

```
minimize: α₁ × 전력비용(송풍기+전기응집) + α₂ × 약품비용 + α₃ × 전극소모비용 + α₄ × 수질위반_페널티

가중치: α₁=0.5, α₂=0.2, α₃=0.2, α₄=0.1
```

### 4.3. 제약조건 (법적 기준)

| 항목 | 법적 기준 | 목표치 (20% 안전마진) |
|------|----------|---------------------|
| COD | ≤ 40 mg/L | ≤ 32 mg/L |
| BOD | ≤ 10 mg/L | ≤ 8 mg/L |
| SS | ≤ 10 mg/L | ≤ 8 mg/L |
| T-N | ≤ 20 mg/L | ≤ 16 mg/L |
| T-P | ≤ 2 mg/L | ≤ 1.6 mg/L |

### 4.4. 경량화 PSO (엣지 최적화)

| 항목 | 설정값 | 기존 대비 |
|------|--------|----------|
| 입자 수 | 20개 | 100개 → 80%↓ |
| 세대 수 | 15세대 | 50세대 → 70%↓ |
| Early Stopping | 3세대 무개선 시 | - |
| 배치 추론 | 20개 입자 동시 평가 | - |
| 실행 시간 | 45초 이내 | 30분 주기에 충분 |

### 4.5. 실행 주기

| 상황 | 주기 |
|------|------|
| 정상 운전 | 30분 |
| 부하 급변 감지 | 즉시 실행 (5분 내) |
| 긴급 상황 | Rule-based 전환 (PSO 우회) |

---

## 5. 제어 시스템

### 5.1. 하이브리드 제어 전략

```
                    ┌─────────────────────────────────┐
                    │     AI Feed-forward (90%)       │
                    │   6시간 선행 예측 기반 제어        │
                    └─────────────┬───────────────────┘
                                  │
    ┌─────────────────────────────┼─────────────────────────────┐
    │                             ▼                             │
    │  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    │
    │  │  전기응집     │    │    MBR      │     │   약품투입    │    │
    │  │  제어모듈     │    │  제어모듈     │     │   제어모듈    │    │
    │  └─────────────┘    └─────────────┘    └─────────────┘     │
    └────────────────────────────────────────────────────────────┘
                                  │
                                  ▼
    ┌─────────────────────────────────────────────────────────┐
    │              실시간 Feedback 보정 (10%)                    │
    │         |실측 - 예측| > 20% 시 가중치 증가                    │
    └─────────────────────────────────────────────────────────┘
```

### 5.2. 부하 기반 제어 알고리즘

| 조건 | 상태 | 제어 조치 |
|------|------|----------|
| 유입 BOD 예측 > 200 mg/L | 고부하 | 송풍기 +25%, 반송슬러지 75%, 체류시간 10h |
| 유입 BOD 예측 < 80 mg/L | 저부하 | Eco Mode, 송풍기 -20%, 간헐 포기 |
| 80~200 mg/L | 정상 | DO 2.0~2.5 mg/L 유지 |
| 수온 < 10°C | 저온 보정 | 송풍량 +15% |
| NH₄-N > 30 mg/L | 질산화 강화 | DO 3.5 mg/L |

### 5.3. EC-MBR 통합 제어 로직

**전기응집 제어:**
| 조건 | 동작 |
|------|------|
| 유입 COD 예측 > 150 mg/L | 전류밀도 ×1.3, 극전환 30→20분 |
| 전압 변동율 > 30% | 초음파 세정 트리거, 극전환 즉시 |

**MBR 연동 제어:**
| 조건 | 동작 |
|------|------|
| TMP 상승률 > 2 kPa/hr | 전기응집 강화, Flux 목표 하향 |
| TMP > 40 kPa | 전기응집 일시 중단, 주간세정 |

### 5.4. 인터락 제어 시스템

**수위 기반 인터락:**

| Tank | 조건 | 동작 |
|------|------|------|
| 분리막조 | L (저수위) | 흡입펌프 정지 |
| 분리막조 | HH (고수위) | 1차처리수조 펌프 정지 |
| 분리막조 | HHAL (초고수위) | 경보 + 유량조정조 펌프 정지 |
| 1차처리수조 | HH | 유량조정조 펌프 정지 |
| 여과수조 | H | 흡입펌프 정지 |
| 방류조 | HH | 여과수조 펌프 정지 |

**DAF 연동 시퀀스:**
1. 유량조정조 펌프 ON → SOL-101 밸브 열림
2. 순환수 가압펌프 가동
3. PAC 약품펌프 가동
4. 교반기 가동 (반응조/pH조정조/응집조)
5. 폴리머 약품펌프 가동
6. OFF 시 역순 정지 (지연 시간 적용)

### 5.5. Safety Layer (6층 검증)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           SafetyLayer                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   Layer 1: 물리적 제약 검증                                                     │
│   • 송풍량 ≤ 22 m³/min, 전류밀도 ≤ 15 A/m², 펌프 용량 초과 여부                      │
│   → 위반 시: 값 클리핑                                                          │
│                                   │ ✅ PASS                                 │
│                                   ▼                                         │
│   Layer 2: 예측 신뢰도 검증                                                     │
│   • Uncertainty < 0.3?                                                      │
│   → 위반 시: 보수적 제어 (안전계수 ×1.2)                                           │
│                                   │ ✅ PASS                                 │
│                                   ▼                                         │
│   Layer 3: 법적 기준 검증                                                       │
│   • 예상 방류 COD < 40 × 0.8 (32 mg/L)?                                        │
│   → 위반 시: 긴급 제어 (송풍량 MAX)                                               │
│                                   │ ✅ PASS                                 │
│                                   ▼                                         │
│   Layer 4: 센서 이상 검증                                                      │
│   • 복수 센서 동시 이상 없음?                                                     │
│   → 위반 시: 수동 모드 전환                                                      │
│                                   │ ✅ PASS                                 │
│                                   ▼                                         │
│   Layer 5: 전극 보호 (EC 특화) ★                                                │
│   • 전압 변동율 < 30%? 전압 급상승 (>5V/min) 없음?                                 │
│   → 위반 시: EC 정지 + 초음파 세정 트리거                                           │
│                                   │ ✅ PASS                                 │
│                                   ▼                                         │
│   Layer 6: 막 보호 (MBR 특화)                                                  │
│   • TMP < 50 kPa? 흡입펌프 연속가동 < 7분?                                        │
│   → 위반 시: 흡입펌프 정지, 세정 트리거                                             │
│                                   │ ✅ PASS                                 │
│                                   ▼                                         │
│                         검증된 ControlCommand 출력                             │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 5.6. 제어 모드 (4단계)

| 모드 | 조건 | TCN | PSO | 송풍기 |
|------|------|-----|-----|--------|
| **정상 AI** | 수질 안정, 신뢰도 높음 | 5분 주기 | 30분 주기 | PSO 최적값 |
| **안전** | 이상 감지, 센서 불확실 | 10분 주기 | 중단 | DO 2.5 mg/L 고정 |
| **비상** | 수질 기준 초과 위험 | 중단 | 중단 | 최대 가동 |
| **Eco** | 저부하, 야간 | 30분 주기 | 1시간 주기 | 간헐 포기 |

**모드 전환 조건:**

| 전환 | 조건 |
|------|------|
| 정상 AI → 안전 | Anomaly Score > 0.7, 예측 불확실성 > 0.3, 센서 2개 이상 이상 |
| 안전 → 비상 | 방류 COD > 36 mg/L, 터보 브로워 정지, TMP > 50 kPa |
| 비상 → 안전 | 방류수질 < 법적 70% 회복, 설비 정상 확인 |
| 안전 → 정상 AI | 24시간 연속 안정 운전, MAPE < 10%, 센서 모두 정상 |

---

## 6. 센싱 레이어

### 6.1. 센서 데이터 수집

| 센서 | 측정 범위 | 정확도 | 주기 | 비고 |
|------|-----------|--------|------|------|
| pH | 0~14 | ±0.1 | 1분 | |
| 수온 | -10~50°C | ±0.5°C | 1분 | |
| SS (탁도계) | 0~500 mg/L | ±5% | 5분 | |
| COD (UV 흡광도) | 0~200 mg/L | ±10% | 15분 | |
| BOD (온라인 분석기) | 0~300 mg/L | ±15% | 1시간 | |
| NH₄-N | 0~50 mg/L | ±5% | 15분 | |
| DO (용존산소) | 0~20 ppm | ±0.2 mg/L | 1분 | |
| 유량 | 0~500 m³/h | ±2% | 1분 | |
| ORP | -500~500 mV | ±10 mV | 1분 | |
| TMP (차압계) | 0~100 kPa | ±1% | 실시간 | |
| EC 전압 | 0~50 V | ±1% | 10초 | EC 특화 |
| EC 전류 | 0~100 A | ±1% | 10초 | EC 특화 |

### 6.2. 데이터 전처리 파이프라인

| 단계 | 방법 | 설명 |
|------|------|------|
| 이상치 탐지 | 3σ + IQR + 물리적 범위 | 센서 고장, 스파이크 감지 |
| 결측치 처리 | 5분 이하: 선형 보간 | |
| | 5~30분: Cubic Spline | |
| | 30분+: 과거 패턴 참조 | 동일 요일/시간대 |
| 드리프트 보정 | Kalman Filter | 센서 드리프트 보정 |
| 동기화 | 1분 단위 정규화 | UTC 타임스탬프 |

### 6.3. 검증 체계 (3-Tier)

| Tier | 주기 | 검증 방법 |
|------|------|----------|
| Tier 1 | 1분 | 센서 간 상관관계 (COD/BOD 비율, DO-송풍량) |
| Tier 2 | 일 1회 | 온라인 분석기 vs AI 예측 (MAPE > 15% 시 재보정) |
| Tier 3 | 주 2회 | 실험실 정밀 분석 (월간 MAPE > 12% 시 재학습) |

### 6.4. 데이터 저장

| 항목 | 설정 |
|------|------|
| 시계열 DB | InfluxDB / TimescaleDB |
| 보관 기간 | 최소 3년 |
| 백업 | 일일 자동 + 월간 외부 저장 |
| 최소 데이터량 | 500만 개 이상 (센서 10종 × 1분 × 1.5년) |

---

## 7. 엣지 인프라 (3-Tier 하이브리드 아키텍처)

### 7.1. 아키텍처 결정 근거

AI 추론을 **Tier 2 (Gateway)**에서 수행:
- 데이터 흐름: Tier 1 수집 → Tier 2 InfluxDB 저장 → AI 추론 → Tier 3 제어
- Tier 2 집중화로 모델 관리, 디버깅, 업데이트 용이
- Tier 1 비용 절감 (Hailo NPU 불필요, ~$100 절약)
- Fallback: 네트워크 단절 시 Tier 1에서 Rule-based로 Tier 3 직접 제어

### 7.2. Tier별 역할 및 비용

| Tier | 하드웨어 | 주요 역할 | 비용 |
|------|---------|----------|------|
| **Tier 1** | RPi 5 (4GB) | 센서 수집, QA/QC, 로컬 캐시, Fallback 제어 | ~$150 |
| **Tier 2** | Mini PC + Hailo-8L | **TCN 추론**, PSO 최적화, DB, Dashboard | ~$300 |
| **Tier 3** | ESP32 + 릴레이 + Safety PLC | 액추에이터 제어 (무인자동/반자동/수동) | ~$100 |
| | | **총 비용** | **~$550/현장** |

### 7.3. Tier 1: 엣지 디바이스

**하드웨어:**
- Raspberry Pi 5 (4GB RAM)
- 128GB microSD
- ADC/I2C/SPI 센서 인터페이스
- 산업용 DIN 레일 케이스 (IP65)
- 전력: 3~5W

**기능:**
- 센서 데이터 수집: 1분 주기 (Modbus TCP, ADC)
- QA/QC 전처리: 이상치 탐지, 결측치 보간
- 로컬 버퍼: 24시간 데이터 캐시
- MQTT 전송: Tier 2로 1분 주기 전송
- **Fallback 제어**: 네트워크 단절 시 Rule-based 직접 제어
  - DO < 1.5 mg/L: 송풍기 RPM +20%
  - pH < 6.5: NaOH 펌프 ON
  - 수위 > HH: 유입펌프 OFF

### 7.4. Tier 2: 게이트웨이

**하드웨어:**
- Mini PC/NUC (8GB RAM, i5급)
- Hailo AI Kit (Hailo-8L NPU, 13 TOPS)
- 256GB SSD

**기능:**
- 데이터 저장: InfluxDB (최소 3년)
- **TCN 예측**: 5분 주기, 0.8~1.2초 (NPU 가속)
- **PSO 최적화**: 30분 주기, 45~90초 (CPU)
- **Safety Layer**: 6층 검증 (실시간)
- Dashboard: Grafana 기반 모니터링
- OTA 업데이트: 모델/설정 원격 배포
- 다중 현장 지원: 5~10개 Tier 1 관리 가능

### 7.5. Tier 3: 제어 계층

**하드웨어:**
- ESP32/Arduino (산업용 모듈)
- 솔리드스테이트 릴레이 모듈
- Safety PLC (핵심 인터락용, 최소화)

**운전 모드:**

| 모드 | 설명 | AI 역할 |
|------|------|---------|
| **무인자동** | AI Feed-forward 제어, PSO 최적값 자동 적용 | 전적 제어 |
| **반자동** | AI 권장 후 운영자 승인 시 실행 | 권장 제공 |
| **수동** | 운영자 직접 제어 | 모니터링만 |

### 7.6. 데이터 압축 및 전송

| 구간 | 주기 | 원본 | 전송 | 압축률 |
|------|------|------|------|--------|
| Edge → Gateway | 10분 | 2,000B | 800B | 60% |
| Gateway → Cloud | 1시간 | 28,800B | 1,200B | 96% |
| 일일 (1개 현장) | - | 2.7GB | 28.8MB | 99% |

### 7.7. 환경 내구성 대응

| 항목 | 사양 |
|------|------|
| 인클로저 등급 | IP68 + NEMA 4X (방진/방수/부식방지) |
| 온도 모니터링 | CPU > 75°C: 팬 부스트 |
| 습도 모니터링 | > 85%: 제습제 교체 알림 |
| 이중화 | N+1 Active-Standby, Failover < 60초 |

---

## 8. 개발 일정 및 비용

### 8.1. 추진 일정

**Phase 1: 기반 구축 및 설계 (1~4개월)**
- 현장 정밀 진단 및 센서 네트워크 구축
- 데이터 수집 파이프라인 및 Edge 인프라 설치
- 초기 데이터 확보 (Cold Start 대응)

**Phase 2: 알고리즘 개발 및 시뮬레이션 (5~8개월)**
- TCN 예측 모델 및 PSO 최적화 엔진 개발
- 가상 환경 시뮬레이션을 통한 제어 로직 검증
- Edge AI 모델 경량화 및 포팅

**Phase 3: 현장 실증 및 최적화 (9~12개월)**
- 실제 플랜트(금강엔지니어링) 적용 및 시운전
- AI 제어 모드 단계적 확대
- 성능 평가 및 공인 인증 획득

### 8.2. 현장 적용 단계

| 단계 | 기간 | 내용 |
|------|------|------|
| 모니터링 | 2주 | AI 예측만, 실제 제어 없음 |
| 반자동 | 2주 | AI 권장 + 운영자 승인 |
| 완전 자동 | 4주 | 주간 완전 자동, 야간 비상 대기 |
| 72시간 무인 | - | 운영자 개입 없는 자율 운전 |
---

## 9. 리스크 및 대응

| 리스크 | 영향 | 대응 방안 |
|--------|------|-----------|
| 모델 예측 오류 | 수질 기준 위반 | Safety Layer 6층 검증, Fallback 전략 |
| PSO 수렴 실패 | 불안정한 제어 | 경량화 PSO, Early Stopping, 이전 최적값 유지 |
| 센서 고장 | 잘못된 입력 | 이중화 센서, 물리적 관계 검증, 추정값 사용 |
| 엣지 장비 고장 | 제어 중단 | N+1 이중화, 자동 Failover (<60초) |
| 네트워크 장애 | 원격 모니터링 불가 | 엣지 독립 운전, 로컬 7일 데이터 보관 |
| 산업 환경 내구성 | 장비 수명 단축 | IP68 인클로저, 환경 모니터링, 예방적 유지보수 |
| NPU 장애 | 추론 불가 | CPU Fallback (TFLite, 5~8초), Rule-based 전환 |

**NPU 장애 대응:**
```
정상: TCN on NPU (0.8~1.2초)
    ↓ NPU 장애 감지
Fallback: TCN on CPU TFLite (5~8초, 정확도 동일)
    ↓ CPU 과부하 시
Emergency: Rule-based 제어 (Safety Layer)
```

---

## 10. 기술 스택

### 10.1. AI/ML

| 구분 | 기술 |
|------|------|
| 딥러닝 프레임워크 | TensorFlow 2.15 |
| 모델 변환 | ONNX, Hailo SDK |
| NPU 가속 | Hailo-8L (13 TOPS) |
| 최적화 알고리즘 | PSO (Particle Swarm Optimization) |

### 10.2. 데이터 & 통신

| 구분 | 기술 |
|------|------|
| 시계열 DB | InfluxDB / TimescaleDB |
| PLC 통신 | Modbus TCP/RTU (pymodbus) |
| 게이트웨이 통신 | MQTT (paho-mqtt) |
| 클라우드 통신 | HTTPS REST API |

### 10.3. 플랫폼

| 구분 | 기술 |
|------|------|
| 엣지 OS | Raspberry Pi OS (64-bit) |
| Python 환경 | UV (가상환경 관리, pip 대비 10~100배 빠름) |
| API 백엔드 | FastAPI (비동기, 자동 API 문서화) |
| 프론트엔드 | HTML/CSS/JavaScript (커스텀 UI) |
| 모니터링 | Grafana (시계열 데이터 시각화, 옵션) |

---

## 11. 용어 정의

| 용어 | 설명 |
|------|------|
| TCN | Temporal Convolutional Network - Hailo NPU 호환 시계열 모델 |
| Dilated Conv | 확장 합성곱 - 넓은 receptive field 확보 기법 |
| PSO | Particle Swarm Optimization (입자군 최적화) |
| Feed-forward | 유입수 기반 사전 제어 방식 |
| Feedback | 방류수 기반 사후 제어 방식 |
| EC-MBR | Electrocoagulation + MBR (전기응집 결합형 분리막 바이오반응기) |
| TMP | Trans-Membrane Pressure (막간압력차) |
| DO | Dissolved Oxygen (용존산소) |
| MAPE | Mean Absolute Percentage Error (평균절대백분율오차) |
| HEF | Hailo Executable Format (Hailo NPU 모델 포맷) |
| OTA | Over-The-Air (원격 업데이트) |
| TCO | Total Cost of Ownership (총소유비용) |
| HHAL | High High Alarm Level (초고수위 경보) |

---

## 부록 A: 핵심 장비 인터락 요약

### A.1. 펌프류 (주요)

| 장비 | 운전 조건 | 인터락 |
|------|-----------|--------|
| 흡입펌프 (A/B/C/D) | 분리막조 HI + 타이머 (7분 ON / 2분 OFF) | LOW→정지, 여과수조 H→정지, 7분 초과→정지 |
| 유량조정조 펌프 (A/B) | 유량조정조 HI | 1차처리수조 HH→정지, DAF 자동 연동 |
| 1차처리수조 펌프 (A/B) | 1차처리수조 H | 분리막조 HH→정지 |
| 여과수조 펌프 (A/B) | 여과수조 H | 방류조 HH→정지 |

### A.2. 약품 투입 펌프

| 장비 | 운전 조건 |
|------|-----------|
| PAC 공급 펌프 | 유량조정조 펌프 연동 |
| 폴리머 공급 펌프 | 유량조정조 펌프 연동 |
| 가성소다 공급 펌프 | 유량조정조 펌프 ON + pH LOW |

### A.3. 송풍/교반

| 장비 | 비고 |
|------|------|
| 터보 브로워 (A/B) | 전력의 50.4% - AI 최적화 핵심 대상 |
| 반응조/pH조정조/응집조 교반기 | 유량조정조 펌프 연동 (60초 지연 정지) |

---

## 부록 B: EC-MBR 차별화 기술 요약

| 기술 | 기존 MBR | EC-MBR AI (제안) | 효과 |
|------|----------|------------------|------|
| 전극 관리 | 수동 점검 | AI 수명 예측 + 자동 극전환 | 전압 변동율 30%↓ |
| 동적막 활용 | 미적용 | Al(OH)₃ 동적막 두께 AI 제어 | Flux 8%↑, 막오염 완화 |
| 통합 최적화 | 개별 제어 | 전기응집+MBR PSO 통합 | 전력비 10%↓ |
| 선제적 제어 | 사후 Feedback | 6시간 선행 Feed-forward | 수질 위반 0회 |

---

**문서 끝**
